<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SuperSplat スクロール・テリング（埋め込み）</title>
  <style>
    :root{ --bg:#0b0f14; --fg:#e9f0f7; --muted:#a7b7c6; --line:#1c2834; --accent:#00c2ff; }
    html,body{ height:100%; margin:0; background:var(--bg); color:var(--fg); font-family: system-ui, -apple-system, "Hiragino Kaku Gothic ProN", Meiryo, sans-serif; }
    .layout{ display:grid; grid-template-columns: 1fr minmax(320px, 520px); grid-template-rows: 100svh; min-height:100svh; }
    .stage{ position:sticky; top:0; height:100svh; border-right:1px solid var(--line); }
    .stage iframe{ position:absolute; inset:0; width:100%; height:100%; border:0; }
    .overlay{ position:absolute; inset:0; pointer-events:none; display:flex; align-items:flex-end; padding: 20px; }
    .overlay .label{ background: #0a1018b3; border:1px solid var(--line); padding:.6rem .75rem; border-radius: 12px; font-size:12px; color:#cfe8ff }

    .story{ height:auto; overflow:visible; }
    .panel{ min-height:92svh; display:flex; flex-direction:column; justify-content:center; gap:1rem; padding: 10svh 28px; border-bottom:1px dashed var(--line); }
    .panel h2{ margin:0; font-size:22px; color:#e7f6ff }
    .panel p{ margin:0; line-height:1.7; color:#c7d5e2 }
    .meta{ font-size:12px; color:var(--muted) }

    @media (max-width: 980px){
      .layout{ grid-template-columns: 1fr; grid-template-rows: 50svh auto; }
      .stage{ order:1; height:50svh }
      .story{ order:2 }
    }
  </style>
</head>
<body>
  <div class="layout">
    <!-- 3DGS（SuperSplat公開URLを埋め込む） -->
    <section class="stage">
      <!-- ▼ ここをあなたの公開URLに置換（例: https://superspl.at/s/abcdef?noui=1 ） -->
      <iframe id="splat" src="https://superspl.at/view?id=c5446431noui=1" allow="xr; fullscreen" loading="eager" title="SuperSplat viewer"></iframe>
      <div class="overlay"><span class="label" id="cur">読込中…</span></div>
    </section>

    <!-- ストーリー（各セクションのスクロールに合わせて字幕や注釈・CSSエフェクトを切替） -->
    <aside class="story" id="story">
      <!-- data-time は SuperSplat のタイムライン（秒）に合わせたメモ用。直接制御はできないため、演出同期の目安として使います。-->
      <section class="panel" data-title="導入" data-time="0-5">
        <h2>① 全体の導入</h2>
        <p>SuperSplat 側でタイムライン（カメラアニメ）を作成し <b>File → Publish</b> で公開します。このページはそのビューワを <code>iframe</code> で埋め込み、左側の原稿をスクロール表示します。</p>
        <p class="meta">Tips: 公開URLの末尾に <code>?noui=1</code> を付けるとUIが隠せます。</p>
      </section>
      <section class="panel" data-title="ポイント1（寄り）" data-time="5-12">
        <h2>② ディテールへ寄る</h2>
        <p>セクションの長さ（高さ）= 読者が読む時間 ≒ SuperSplat のキーフレーム間の秒数、で大まかに合わせると同期感が高まります。</p>
      </section>
      <section class="panel" data-title="俯瞰" data-time="12-20">
        <h2>③ 俯瞰ビュー</h2>
        <p>必要ならパネル内に写真や地図（<code>&lt;img&gt;</code> / <code>&lt;iframe&gt;</code>）を差し込み、視線誘導を作ります。</p>
      </section>
      <section class="panel" data-title="まとめ" data-time="20-28">
        <h2>④ まとめ</h2>
        <p>音声やBGMはビューワ側の動画レンダ（SuperSplat 2.2以降）を使って差し替える方法もあります。</p>
      </section>
    </aside>
  </div>

  <script>
    // ▼ 進行中のセクションの見出しを右下ラベルに反映（簡易同期表示）
    const cur = document.getElementById('cur');
    const panels = [...document.querySelectorAll('.panel')];
    const storyRoot = document.getElementById('story');

    const io = new IntersectionObserver((ents)=>{
      for(const en of ents){
        if(en.isIntersecting){
          const t = en.target.dataset.title || '';
          const tm = en.target.dataset.time || '';
          cur.textContent = t + (tm? `｜${tm}s` : '');
        }
      }
    }, { root: storyRoot, threshold: .6 });
    panels.forEach(p=>io.observe(p));

    // ▼ スクロール到達時に、わずかな視覚効果（iframeのCSSフィルタ）を切り替える例
    //   ※ カメラ自体の制御は SuperSplat 側のタイムラインで行います。
    function setFX(idx){
      const iframe = document.getElementById('splat');
      const effects = [
        'none',
        'contrast(1.06) saturate(1.05)',
        'brightness(1.02) saturate(1.1)',
        'contrast(1.05)'
      ];
      iframe.style.filter = effects[idx % effects.length];
    }
    panels.forEach((p,i)=>{
      p.addEventListener('mouseenter', ()=>setFX(i));
    });

    // ▼ 参考：もし自己ホストしたエクスポートHTMLに postMessage 受信コードを追加した場合、
    //   ここでセクション→フレームの対応づけを送り込めます（公開ビューワでは未サポート）。
    //   window.frames[0].postMessage({type:'gotoFrame', frame: 120}, '*');
  </script>
</body>
</html>
